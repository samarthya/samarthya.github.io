---
title: "Projects & Activity"
format:
  html:
    page-layout: full
---

<div class="github-nav">
  <a href="#activity" class="nav-item active" data-target="activity">Activity</a>
  <a href="#projects" class="nav-item" data-target="projects">Projects</a>
  <div class="nav-indicator"></div>
</div>

<div id="activity" class="content-section active">

```{python}
#| echo: false
#| output: asis
#| raw: true

import requests
from datetime import datetime, timedelta, timezone
import json
from IPython.display import HTML, display

def format_event_details(event):
    """Format event details based on event type"""
    try:
        event_type = event.get('type')
        repo = event.get('repo', {})
        repo_name = repo.get('name', 'unknown')
        payload = event.get('payload', {})

        if event_type == 'PushEvent':
            commits = payload.get('commits', [])
            commit_messages = [commit.get('message', '(no message)') for commit in commits if isinstance(commit, dict)]
            description = f"Pushed {len(commits)} commit(s) to {repo_name}"
            details = "<br>".join(f"• {msg}" for msg in commit_messages[:3])
            if len(commits) > 3:
                details += "<br>• ..."
        elif event_type == 'CreateEvent':
            ref_type = payload.get('ref_type', 'ref')
            description = f"Created {ref_type} in {repo_name}"
            details = ""
        elif event_type == 'IssuesEvent':
            action = payload.get('action', 'updated')
            issue = payload.get('issue', {})
            issue_title = issue.get('title', '(no title)')
            description = f"{action.capitalize()} issue in {repo_name}"
            details = f"• {issue_title}"
        elif event_type == 'PullRequestEvent':
            action = payload.get('action', 'updated')
            pull_request = payload.get('pull_request', {})
            pr_title = pull_request.get('title', '(no title)')
            description = f"{action.capitalize()} pull request in {repo_name}"
            details = f"• {pr_title}"
        else:
            return None

        return {
            'description': description,
            'details': details,
            'repo_url': f"https://github.com/{repo_name}"
        }
    except Exception:
        # Broad exception handling to ensure site renders even with malformed events
        # During static site generation, we prefer graceful degradation over crashes
        return None

def fetch_github_activity(username="samarthya", days=30):
    # Get user events
    url = f"https://api.github.com/users/{username}/events/public"
    
    try:
        response = requests.get(url, timeout=10)
        
        if response.status_code != 200:
            return []
        
        events = response.json()
    except (requests.RequestException, requests.Timeout, ValueError, json.JSONDecodeError):
        # Handle network/API failures and JSON parsing errors gracefully
        # Return empty list to allow site to render gracefully even when GitHub API is unavailable
        return []

    # Process and format events
    formatted_events = []
    cutoff_time = datetime.now(timezone.utc) - timedelta(days=days)
    
    for event in events:
        try:
            created_at = event.get('created_at')
            if not created_at:
                continue
                
            event_time = datetime.strptime(created_at, '%Y-%m-%dT%H:%M:%SZ').replace(tzinfo=timezone.utc)

            # Skip events older than specified days
            if event_time < cutoff_time:
                continue

            event_type = event.get('type')
            repo = event.get('repo', {})
            repo_name = repo.get('name')
            payload = event.get('payload', {})
            
            if not event_type or not repo_name:
                continue

            # Format the event description based on type
            if event_type == 'PushEvent':
                commits = payload.get('commits', [])
                commit_messages = [commit.get('message', '(no message)') for commit in commits if isinstance(commit, dict)]
                description = f"Pushed {len(commits)} commit(s) to {repo_name}"
                details = "<br>".join(f"• {msg}" for msg in commit_messages[:3])
                if len(commits) > 3:
                    details += "<br>• ..."
            elif event_type == 'CreateEvent':
                ref_type = payload.get('ref_type', 'ref')
                description = f"Created {ref_type} in {repo_name}"
                details = ""
            elif event_type == 'IssuesEvent':
                action = payload.get('action', 'updated')
                issue = payload.get('issue', {})
                issue_title = issue.get('title', '(no title)')
                description = f"{action.capitalize()} issue in {repo_name}"
                details = f"• {issue_title}"
            elif event_type == 'PullRequestEvent':
                action = payload.get('action', 'updated')
                pull_request = payload.get('pull_request', {})
                pr_title = pull_request.get('title', '(no title)')
                description = f"{action.capitalize()} pull request in {repo_name}"
                details = f"• {pr_title}"
            else:
                continue

            formatted_events.append({
                'date': event_time.strftime('%B %d, %Y'),
                'description': description,
                'details': details,
                'repo_url': f"https://github.com/{repo_name}"
            })
        except (KeyError, TypeError, AttributeError, ValueError):
            # Skip individual events with parsing errors
            continue

    return formatted_events

# Fetch and display activity
events = fetch_github_activity()

if events:
    html_content = '<div class="activity-timeline">'
    current_date = None

    for event in events:
        if event['date'] != current_date:
            if current_date is not None:
                html_content += '</div>'
            current_date = event['date']
            html_content += f'<div class="activity-date">{current_date}</div><div class="activity-group">'

        html_content += f'''
        <div class="activity-item">
            <div class="activity-dot"></div>
            <div class="activity-content">
                <a href="{event['repo_url']}" class="activity-link" target="_blank">{event['description']}</a>
                <div class="activity-details">{event['details']}</div>
            </div>
        </div>
        '''

    html_content += '</div></div>'

    display(HTML(html_content))
else:
    display(HTML('<p>No recent GitHub activity to display.</p>'))
```

</div>

<div id="projects" class="content-section">

```{python}
#| echo: false
#| output: asis
#| raw: true

import requests
import json
from datetime import datetime
from IPython.display import HTML, display

def fetch_github_repos(username="samarthya"):
    url = f"https://api.github.com/users/{username}/repos"
    
    try:
        response = requests.get(url, timeout=10)
        if response.status_code == 200:
            repos = response.json()
            # Sort by stars and get top 5
            return sorted(repos, key=lambda x: (x.get('stargazers_count', 0), x.get('forks_count', 0)), reverse=True)[:5]
    except (requests.RequestException, ValueError, json.JSONDecodeError):
        # Handle network/API failures (timeouts, rate limits, JSON errors, etc.)
        # Pass to fall through to return [] below
        pass
    
    return []

repos = fetch_github_repos()

if repos:
    # Build HTML content
    html_content = '<div class="projects-grid">'
    for repo in repos:
        try:
            # Format date with safe access
            updated_at_str = repo.get('updated_at')
            if updated_at_str:
                updated_at = datetime.strptime(updated_at_str, '%Y-%m-%dT%H:%M:%SZ').strftime('%B %d, %Y')
            else:
                updated_at = 'Unknown'

            # Fix language color display
            language = repo.get('language')
            language_colors = {
                'java': '#b07219',
                'python': '#3572A5',
                'javascript': '#f1e05a',
                # Add more languages as needed
            }
            language_color = language_colors.get(language.lower(), '#888') if language else '#888'

            html_content += f"""
            <div class="project-card">
                <h3><a href="{repo.get('html_url', '#')}" target="_blank">{repo.get('name', 'Unknown')}</a></h3>
                <p class="description">{repo.get('description') or 'No description available'}</p>
                <div class="stats">
                    <span><i class="fas fa-star"></i> {repo.get('stargazers_count', 0)}</span>
                    <span><i class="fas fa-code-branch"></i> {repo.get('forks_count', 0)}</span>
                    <span><i class="fas fa-circle" style="color: {language_color};"></i> {language or 'Unknown'}</span>
                </div>
                <div class="updated">Last updated: {updated_at}</div>
            </div>
            """
        except Exception:
            # Skip individual repos that cause unexpected errors (malformed data, parsing issues)
            # Allows processing to continue for remaining repos
            continue
    html_content += '</div>'

    # Display the HTML content
    display(HTML(html_content))
else:
    display(HTML('<p>No GitHub repositories to display.</p>'))
```

:::{.callout-note}
These are my top 5 GitHub repositories based on stars and forks. Click on any project to view its source code and documentation.
:::